(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9418],{28386:function(e,t,s){"use strict";s.d(t,{Z:function(){return G}});var a=s(85893),n=s(67294),o=s(45697),r=s.n(o),i=s(86979),l=s(9693),m=s(97501),c=s(22553),d=s(53856),p=s(67344),h=s(18460),u=s(15477),g=s(12371),_=s.n(g),f=s(49872),x=s.n(f),j=s(94184),y=s.n(j),b=s(42495),C=s(41664),v=s.n(C),M=s(75215),S=s(51788);function Z(e){return(0,a.jsx)(E,{isReply:!0,...e})}var k=s(54490),N=s(86896),w=s(56064),P=s(36624),R=s(34017);let B=(0,k.vU)({reply:{id:"comment.reply",defaultMessage:"回复"},post:{id:"comment.post",defaultMessage:"发表"},cancel:{id:"comment.cancel",defaultMessage:"取消"},loginfirst:{id:"comment.loginfirst",defaultMessage:"登录后才能评论哦 (\xb4^ω^`)"},replyTarget:{id:"comment.replyTarget",defaultMessage:"回复 @{target}"},saysth:{id:"comment.saysth",defaultMessage:"说些什么..."},disabled:{id:"comment.disabled",defaultMessage:"评论已关闭"}}),D=e=>{let{canComment:t,onSubmit:s,onCancel:o,isReply:r,topComment:i,replyTarget:l}=e,c=(0,w.oR)(),p=(0,N.Z)(),[h,u]=(0,n.useState)(""),[g,f]=(0,n.useState)(!1),x=c.getState().auth.user.isLogin;async function j(){if(1>h.trim())return c.dispatch((0,P.jW)("error","评论不能为空"));f(!0);try{await s(h,l,i),u(""),o&&o()}catch(e){}finally{f(!1)}}return(0,a.jsxs)("div",{className:y()(_().commentEditor,{[_().reply]:r}),children:[(0,a.jsx)(R.Z,{fullWidth:!0,value:h,onChange:function(e){let t=e.target.value;t.length<=1e3?u(t):c.dispatch((0,P.jW)("error","评论字数超限"))},placeholder:x?t?r?"".concat(p.formatMessage(B.replyTarget,{target:l.user_name})):p.formatMessage(B.saysth):p.formatMessage(B.disabled):p.formatMessage(B.loginfirst),required:!0,disabled:!x||!t,className:_().textarea}),(0,a.jsxs)("div",{className:_().commentButton,children:[(0,a.jsx)(d.ZP,{auto:!0,className:_().submitBtn,onPress:j,disabled:!x||!t||g,children:g?(0,a.jsx)(m.ZP,{color:"currentColor",size:"sm"}):r?p.formatMessage(B.reply):p.formatMessage(B.post)}),r&&(0,a.jsx)(d.ZP,{auto:!0,bordered:!0,onPress:o,children:p.formatMessage(B.cancel)})]})]})};D.propTypes={onSubmit:r().func.isRequired,onCancel:r().func,isReply:r().bool,replyTarget:r().object,topComment:r().number,canComment:r().bool};var L=s(27484),O=s.n(L),I=s(44012),A=s(63763),T=s(80534),E=e=>{let{isReply:t,commentData:s,commentAuthor:o,commentLength:r,commentIndex:i,topComment:l,onReport:m,myself:d,onReply:h,onSubmitReply:g,onDelete:f}=e,[x,j]=(0,n.useState)(!1),[C,k]=(0,n.useState)(!1),[P,R]=(0,n.useState)(!1),[B,L]=(0,n.useState)(!1),[E,F]=(0,n.useState)(1),[q,z]=(0,n.useState)(1),H=(0,w.v9)(e=>e.auth.permission.includes("MANAGE_COMMENT")),[U,W]=(0,n.useState)([]),G=(0,N.Z)(),Y=(0,n.useRef)();return(0,n.useEffect)(()=>{let e=/#comment-([0-9]*)$/.exec(location.hash);async function a(){let t=await A.Z.get("comment/getChildren?parent=".concat(s.id,"&page=").concat(E,"&limit=5"));if(e&&!B){for(let a=1;a<t.data.pager.page+1;a++){let t=await A.Z.get("comment/getChildren?parent=".concat(s.id,"&page=").concat(a,"&limit=5"));for(let s=0;s<t.data.comments.length;s++){let n=t.data.comments[s];if(n.id==e[1]){L(!0),W(t.data.comments),F(a),z(t.data.pager.page);return}}}W(t.data.comments),z(t.data.pager.page)}else W(t.data.comments&&t.data.comments.reverse()),z(t.data.pager.page)}e&&e[1]==s.id&&R(!0),s.children&&s.children.length>=5&&!t||null===s.children?a():W(s.children&&s.children.reverse())},[E,s.children,s.id,t]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.ZP,{ref:Y,xs:20,className:y()(_().floor,{[_().reply]:t,[_().highlight]:P}),onMouseLeave:()=>j(!1),children:(0,a.jsxs)("div",{className:_().commentFloor,children:[(0,a.jsx)("div",{className:_().avatar,children:(0,a.jsx)(M.Z,{passHref:!0,user:s.user,name:s.user_name,size:t?40:50,avatar:s.user_avatar})}),(0,a.jsxs)("div",{style:{width:"100%"},children:[(0,a.jsx)("div",{className:_().avatar,children:(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,a.jsx)(v(),{href:"/user/".concat(s.user),passHref:!0,className:y()(_().username,{[_().replyUser]:t}),target:"_blank",children:s.user_name}),s.user_budge&&s.user_budge.length>=1&&(0,a.jsx)("div",{className:_().budge,children:s.user_budge.map(e=>(0,a.jsx)(b.ZP,{content:e.name,children:(0,a.jsx)("div",{className:_().item,children:(0,a.jsx)("img",{src:e.icon,alt:e.name})})},e.id))}),t&&l.user===s.user&&(0,a.jsx)("span",{className:_().commentOP,children:(0,a.jsx)(I.Z,{id:"commet.reply.op",defaultMessage:"层主"})}),!!o&&o===s.user&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("span",{className:_().commentOP,style:{background:"#37b968"},children:(0,a.jsx)(I.Z,{id:"commet.reply.author",defaultMessage:"作者"})})}),t&&!!s.reply_to&&(0,a.jsxs)("div",{style:{display:"flex"},children:[(0,a.jsx)(u._Q,{title:"回复",set:"bold",size:"small",style:{display:"block",margin:"auto"}}),(0,a.jsx)(v(),{className:y()(_().username,{[_().replyUser]:t}),target:"_blank",passHref:!0,href:"/user/".concat(s.reply_to),children:s.reply_to_name?s.reply_to_name:(0,a.jsx)(I.Z,{id:"commet.reply.unknownuser",defaultMessage:"未知用户"})})]})]})}),(0,a.jsx)(S.Z,{headless:!0,content:s.content}),(0,a.jsxs)("div",{className:_().info,children:[(0,a.jsxs)("div",{style:{display:"flex"},children:[(0,a.jsx)(b.ZP,{style:{display:"flex"},content:O()(s.created_at).format("LLLL"),children:(0,a.jsx)("span",{children:O()(s.created_at).fromNow()})}),(0,a.jsx)("span",{className:_().location,children:""!=s.location&&(0,T.k)("showip")&&(0,a.jsx)(I.Z,{id:"commet.postby",defaultMessage:"来自{location}",values:{location:G.$t({id:s.location})}})})]}),(0,a.jsxs)("div",{className:_().operation,children:[(0,a.jsx)("div",{className:_().spot,title:G.$t({id:"general.reply",defaultMessage:"回复"}),onClick:()=>k(!0),children:(0,a.jsx)(u.en,{size:"small",primaryColor:"#888",set:"curved"})}),(0,a.jsx)("div",{className:_().spot,onClick:()=>j(!x),children:(0,a.jsx)(u.XE,{size:"small",primaryColor:"#888"})}),(0,a.jsx)("div",{className:y()(_().operaList,{[_().operaListOpen]:x}),onClick:()=>setTimeout(()=>j(!1),100),children:(0,a.jsxs)("ul",{children:[(f&&(null==d?void 0:d.id)===s.user||H)&&(0,a.jsxs)("li",{onClick:()=>f(s,t),children:[(0,a.jsx)(u.HG,{size:"small"}),(0,a.jsx)(I.Z,{id:"general.delete",defaultMessage:"删除"})]}),m&&(0,a.jsxs)("li",{onClick:()=>m(s,t),children:[(0,a.jsx)(u.Zd,{size:"small"}),(0,a.jsx)(I.Z,{id:"general.report",defaultMessage:"举报"})]})]})})]})]})]})]})}),C&&(0,a.jsx)(D,{isReply:!0,canComment:!0,topComment:null!=l?l:s,replyTarget:s,onSubmit:g,onCancel:()=>k(!1)}),!t&&U&&U.length>0&&U.map(e=>(0,a.jsx)(Z,{topComment:s,onSubmitReply:g,commentData:e,commentAuthor:o,onReport:m,myself:d,onReply:h,onDelete:f},e.id)),!t&&q>1&&(0,a.jsx)("div",{className:_().pagination,style:{width:"100%",marginBottom:"5px"},children:(0,a.jsx)(p.ZP,{initialPage:E,page:E,size:"xs",onChange:e=>{F(e),window.scrollTo({top:Y.current.getBoundingClientRect().top+window.scrollY-80,behavior:"smooth"})},total:q})})]})},F=s(84551),q=s(74806),z=s(76064),H=s(65064);let U=(0,k.vU)({title:{id:"comment.title",defaultMessage:"评论"},reply:{id:"comment.reply",defaultMessage:"回复"},success:{id:"comment.postSuccess",defaultMessage:"{type} 成功!"},postfail:{id:"comment.postFail",defaultMessage:"{type} 失败了: {err}"},error:{id:"comment.error",defaultMessage:"加载失败 (\xb4・ω・`)"},nobody:{id:"comment.nobody",defaultMessage:"还没有人在这评论哟"},request:{id:"comment.request",defaultMessage:"快来抢沙发吧！"},requireLogin:{id:"comment.requireLogin",defaultMessage:"请先登录！"},reportself:{id:"comment.reportself",defaultMessage:"不能举报你自己呦~"},deleteFailed:{id:"comment.deleteFailed",defaultMessage:"删除评论失败："}});class W extends n.Component{componentDidMount(){let e=location.hash.match(/#comment-([0-9]*)$/);if(e){this.getCommentById(e[1]);return}this.getComment(!0)}componentDidUpdate(e){this.props.obj!==e.obj&&this.setState({page:1},()=>this.getComment(!0))}getComment(e){let{obj:t}=this.props,{page:s}=this.state;A.Z.get("comment/getList?obj=".concat(t,"&page=").concat(s,"&limit=10")).then(t=>{let s=t.data,a=t.data.comments;this.setState({loadingState:"LOADED",pager:s.pager,comments:a},()=>{e||window.scrollTo({top:this.ref.current.getBoundingClientRect().top+window.scrollY-90,behavior:"smooth"})})}).catch(()=>{this.setState({loadingState:"ERROR"})})}getCommentById(e){let{obj:t}=this.props,{page:s}=this.state;A.Z.get("comment/getCommentById?id=".concat(e,"&obj=").concat(t)).then(e=>{let t=[e.data];if(0!==e.data.parent){this.getCommentById(e.data.parent);return}this.setState({loadingState:"LOADED",isShowCommentId:!0,comments:t},()=>{window.scrollTo({top:this.ref.current.getBoundingClientRect().top+window.scrollY+130,behavior:"smooth"})})}).catch(()=>{this.getComment(!1),this.props.openSnackBar("评论不存在！","error")})}handleChangePage(e){this.setState({page:e,loadingState:"LOADING"},this.getComment)}handleReport(e){let t=this.props.intl;return this.props.isLogin?this.props.userInfo.id==e.user?this.props.openSnackBar(t.formatMessage(U.reportself),"error"):void this.setState({reportModalOpen:!0,reportId:e.id}):this.props.openSnackBar(t.formatMessage(U.requireLogin),"error")}async handleDelete(e){let t=this.props.intl;if(await this.props.openAlert("警告","你确定要删除这条评论吗，删除后不可恢复"))try{await A.Z.post("comment/delete",{id:e.id,container:this.props.obj}),this.props.openSnackBar(t.formatMessage(U.success,{type:t.formatMessage({id:"general.deleteSuccess",defaultMessage:"删除成功~"})}),"success"),this.getComment()}catch(e){this.props.openSnackBar(t.formatMessage(U.deleteFailed)+e.message,"error")}}handleSubmit(e,t,s){let a=this.props.intl,n={container:this.props.obj,content:e};return t&&(n.parent=s.id,t.user!==this.props.userInfo.id&&(n.reply_to=t.user)),new Promise((e,s)=>{A.Z.post("comment/add",n).then(()=>{this.props.openSnackBar(a.formatMessage(U.success,{type:"".concat(t?a.formatMessage(U.reply):a.formatMessage(U.title))}),"success"),e(),this.handleChangePage(1)}).catch(e=>{this.props.openSnackBar(a.formatMessage(U.postfail,{type:"".concat(t?a.formatMessage(U.reply):a.formatMessage(U.title)),err:e.message}),"error"),s()})})}render(){let{canComment:e,myself:t,intl:s}=this.props,{comments:n,loadingState:o,pager:r}=this.state;return(0,a.jsx)(H.Z,{children:(0,a.jsxs)("div",{className:_().comment,ref:this.ref,children:[(0,a.jsxs)("div",{className:_().commentHead,children:[(0,a.jsx)(u.en,{}),(0,a.jsxs)(i.Z,{h4:!0,children:[s.formatMessage(U.title),!!r.quantity&&r.quantity>0&&" (".concat(r.quantity,")")]})]}),(0,a.jsx)(l.Z,{y:1}),(0,a.jsx)(D,{canComment:e,onSubmit:this.handleSubmit}),(0,a.jsx)("div",{className:y()(_().commentContent,{[_().empty]:"LOADED"===o&&0===n.length||"ERROR"===o,[_().loading]:"LOADING"===o}),children:"LOADING"===o?(0,a.jsx)(m.ZP,{}):"ERROR"===o?(0,a.jsxs)("div",{children:[(0,a.jsx)(h.Z,{size:100,mood:"ko",color:"#83D1FB"}),(0,a.jsx)("p",{children:s.formatMessage(U.error)})]}):0===n.length?(0,a.jsxs)("div",{children:[(0,a.jsx)(h.Z,{size:100,mood:"shocked",color:"#83D1FB"}),(0,a.jsx)("p",{children:s.formatMessage(U.nobody)}),(0,a.jsx)("p",{children:s.formatMessage(U.request)})]}):(0,a.jsx)(c.ZP.Container,{gap:1,children:n.map((e,s)=>(0,a.jsx)(E,{commentLength:n.length,commentIndex:s,onDelete:this.handleDelete,myself:t,commentAuthor:this.props.commentAuthor,onSubmitReply:this.handleSubmit,onReport:this.handleReport,commentData:e},e.id))})}),(0,a.jsx)("div",{className:_().pagination,children:this.state.isShowCommentId?(0,a.jsx)(d.ZP,{onPress:()=>{this.setState({isShowCommentId:!1},()=>{location.hash="",this.getComment(!1)})},children:(0,a.jsx)(I.Z,{id:"comment.showAllComment",defaultMessage:"显示所有评论"})}):"LOADED"===this.state.loadingState&&this.state.pager.quantity>10&&(0,a.jsx)(p.ZP,{initialPage:this.state.page,onChange:e=>{this.handleChangePage(e)},total:this.state.pager.page})}),(0,a.jsx)(F.Z,{open:this.state.reportModalOpen||!1,onClose:()=>this.setState({reportModalOpen:!1}),reportType:"c",reportId:this.state.reportId||0})]})})}constructor(e){super(e),this.state={comments:[],pager:{},page:1,loadingState:"LOADING"},x()(this,["handleReport","handleSubmit","handleChangePage","getComment","handleDelete"]),this.ref=n.createRef()}}W.propTypes={canComment:r().bool,commentAuthor:r().number,myself:r().object,obj:r().string.isRequired},W.defaultProps={canComment:!0};var G=(0,q.ZP)((0,w.$j)(e=>({isLogin:e.auth.user.isLogin,userInfo:e.auth.user.userInfo}),e=>({openSnackBar:(t,s)=>e((0,P.jW)(s,t)),openAlert:(t,s)=>e((0,z.qR)(t,s))}))(W))},51788:function(e,t,s){"use strict";var a=s(85893),n=s(24002),o=s(39359),r=s(38522),i=s(92084),l=s(5622),m=s.n(l),c=s(67294),d=s(94184),p=s.n(d),h=s(34017),u=s(79592),g=s.n(u);t.Z=e=>{let{content:t,placeholder:s,editable:l,onUpdate:d,minRow:u,row:_,html:f=!1,headless:x=!1,initial:j=!1,lock:y=!1}=e,[b,C]=(0,c.useState)(j),[v,M]=(0,c.useState)(t),S=()=>m()({ignoreMissing:!0});return((0,c.useEffect)(()=>{M(t)},[t]),x)?(0,a.jsx)(n.D,{remarkPlugins:[o.Z,r.Z],remarkRehypeOptions:{ignoreMissing:!0},rehypePlugins:[i.Z,S],className:p()(g().render,"markdown-body"),linkTarget:"_blank",children:v}):(0,a.jsx)(a.Fragment,{children:b?(0,a.jsx)(h.Z,{fullWidth:!0,initialValue:v,autoFocus:!0,className:g().textarea,rows:_,onBlur:e=>{d&&v!=e.target.value&&d(e.target.value),M(e.target.value),y||C(!1)}}):(0,a.jsx)("div",{className:g().box,onClick:()=>{!y&&l&&C(!0)},children:(0,a.jsx)(n.D,{remarkPlugins:[o.Z],rehypePlugins:[S],className:p()(g().render,"markdown-body",{[g().placeholder]:""===v}),linkTarget:"_blank",children:""===v?s:v})})})}},84551:function(e,t,s){"use strict";var a=s(85893),n=s(67294),o=s(70822),r=s(86979),i=s(34017),l=s(53856),m=s(97501),c=s(56064),d=s(36624),p=s(45697),h=s.n(p),u=s(90684),g=s.n(u),_=s(49872),f=s.n(_),x=s(11752),j=s.n(x),y=s(63763);let{publicRuntimeConfig:b}=j()(),C={c:"评论",u:"用户",p:"作品"};class v extends n.Component{componentDidUpdate(e){e.open!==this.props.open&&this.setState({value:"",reporting:!1})}async handleReport(){if(this.state.value.trim().length<10)return this.props.openSnackBar("请输入举报原因，最少需要10个字哟","error");let{reportType:e,reportId:t}=this.props;this.setState({reporting:!0});try{await y.Z.post("inform/addReport",{obj:"".concat(e).concat(t),content:this.state.value.trim()}),this.props.openSnackBar("举报成功(^o^)，我们会尽快处理","success"),this.props.onClose()}catch(e){this.props.openSnackBar("举报失败，请稍后再试","error")}this.setState({reporting:!1})}handleChange(e){this.setState({value:e.target.value})}render(){let{reportType:e}=this.props;return(0,a.jsxs)(o.ZP,{closeButton:!0,width:"600px","aria-labelledby":"report",open:this.props.open,onClose:this.props.onClose,className:g().modal,children:[(0,a.jsx)(o.ZP.Header,{children:(0,a.jsxs)(r.Z,{id:"modal-title",size:20,children:["举报",C[e]]})}),(0,a.jsxs)(o.ZP.Body,{className:g().content,children:[(0,a.jsxs)("p",{className:g().content,children:["本功能用于向社区管理员反馈该用户的违规行为，",(0,a.jsx)("br",{}),"例如违规发布/改编作品，言语攻击他人，或是违反了",(0,a.jsx)("a",{href:"".concat(b.basePath,"/legal/tos?fullscreen=1"),t:!0,target:"_blank",rel:"noreferrer",style:{color:"#0070f3"},children:"《别针编程服务条款》"}),(0,a.jsx)("br",{}),"请在下方的输入框中填写完整的该用户违规具体记录，",(0,a.jsx)("br",{}),"详细的记录能够帮助管理员更加精确快速的处理违规行为。",(0,a.jsx)("br",{})]}),(0,a.jsx)("p",{className:g().grey,children:"tips: 不要因为个人情绪等原因举报噢￣へ￣"}),(0,a.jsx)(i.Z,{required:!0,onChange:this.handleChange,value:this.state.value,placeholder:"举报内容",minRows:5,minLength:10,maxLength:300,className:g().textarea})]}),(0,a.jsx)(o.ZP.Footer,{children:(0,a.jsx)(l.ZP,{auto:!0,onClick:this.handleReport,disabled:this.state.reporting,children:this.state.reporting?(0,a.jsx)(m.ZP,{color:"currentColor",size:"sm"}):"举报"})})]})}constructor(e){super(e),f()(this,["handleChange","handleReport"]),this.state={value:"",reporting:!1}}}v.propTypes={open:h().bool,type:h().string,onClose:h().func},t.Z=(0,c.$j)(null,e=>({openSnackBar:(t,s)=>e((0,d.jW)(s,t))}))(v)},12120:function(e,t,s){"use strict";var a=s(79177);t.Z=a.h4},12371:function(e){e.exports={commentHead:"comment_commentHead__TA3y9",budge:"comment_budge__cVsKI",item:"comment_item__dUaN9",highlight:"comment_highlight__V01Tz",commentFloor:"comment_commentFloor__tgKuQ",line:"comment_line__Zj6Fs",commentButton:"comment_commentButton__vnIPl",commentContent:"comment_commentContent__OWCdk",textarea:"comment_textarea__U47a7",empty:"comment_empty__KD3kw",info:"comment_info__mJdHj",id:"comment_id__9DEqY",username:"comment_username__OSuNr",operation:"comment_operation__F5g2j",operaList:"comment_operaList__pGCPM",commentWatermark:"comment_commentWatermark__BDuDA",pagination:"comment_pagination__QH0hY",commentOP:"comment_commentOP__HL_nB",loading:"comment_loading__l_C1J",commentEditor:"comment_commentEditor__rt8b_",floor:"comment_floor__blciw",reply:"comment_reply__ffsuG",avatar:"comment_avatar__9Abdh",replyUser:"comment_replyUser___fPlN",operaListOpen:"comment_operaListOpen__nz9AI",spot:"comment_spot__k1Qxf"}},79592:function(e){e.exports={box:"markdown_box__TfpZw",render:"markdown_render__w4rvS",placeholder:"markdown_placeholder__bD6ms",textarea:"markdown_textarea__YGkOA"}},90684:function(e){e.exports={content:"report-modal_content__YxC7Z",grey:"report-modal_grey__y69J9",modal:"report-modal_modal__W37Xb",input:"report-modal_input__b_gF1",textarea:"report-modal_textarea__0Fa2j"}}}]);